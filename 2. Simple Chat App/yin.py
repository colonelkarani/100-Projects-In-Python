import socket
import threading
import sys


print('''\033[91m
                                                                     .    ..........................
                                                                       .   ..  . ...................
                                                                              .....  ...............
                                             ... .                             .   .. ..............
                                 .     . ....:::.....           .             .    ... .............
                           .      .::-**---=*+==+:.::-::.... . ..                    . .............
                          ..::.....=%%%%@@@@%@@%###*+**==+--:..........:...     . . ....  ..........
                       .-.::+-::-=*%@@@@@@@@@@@@@@@@@@%%*=--=+--=---=-:.::.....   ..  .  ... .......
                      . -::=+%#**#@@@@@@@@@@@@@@#+-..     ...   .---*+=++-:-:..:...  . ... .........
                   -..:+%--*@@%@@@@@@@@@@@@%+-.                ..:..-++=*+=-::.:::......... ........
                  ...=*#*%#@@@@@@@@@@@@@@+-.                      .. -*#+=*==+=--::...... .... .....
                   .:-+%@@@@@@@@@@@@@@%+. .                  =-.   .  .:*==++#++==--::::............
             -:   .-#%@@@@@@@@@@@@@@@%=:           ..::..      . ...    .--++#@%###=--:::.... ......
             .*. :=@@@@@@@@@@@@@@@@@%+     .:  .=.:-:.- .:    .     . -#- .+===*%#+*+=-:::.. .. ... 
              .::@@@@@@@@@@@@@@@@@@#:     -.  -::-+++**+::     .. .   :::-==+*%=+@@%%#=-::..........
           ..:-+@@@@@@@@@@@@@@@@@@#=     .   .:=*@@@@@@@@=:            ..:=-:-+##@@@%++=-::.........
        ..  .-+%@@@@@@@@@%@@@@@@@@#-       ....-@@@@@@@@@*=.        :-.  . ::==++%#@@@#*+--:........
         .*#*+*@@@@@@@@@%@@@@@@@@@%-      :  .:=@@@@@@@@@@+:     .   ...  . :-+*=:+*@@%%#+=::...... 
        -+*@**%@@@@@@@@%@@@@@@@@@@*=      :    -#@@@@@@@@#::  .  .      .   -=-==*@%#%@@#++-::... . 
        =-:@@@@@@@@@@@@@@@@@@@@@@@#=       =  . .+#@@@@@=.:.    :..      .:  :::=-@@%%@@@**=-:::....
        .=-*@@@@@@@@@@@@@@@@%@@@@@%+.      .    .   :..  .... :-:..        :  *==++@+%@@@@#++-=:....
   .  ..+++%@@%@@@@@@@@@@@@@%@@@@@@#=.                   :.  :. .:.      :-.:  ++=#*@%*@@@%#=--:....
      .-*+#@@@@@@@@%%@@@@@@@%@@@@@@@#-:                   ..  ..   .:..... :.: .==%#%@*%@@%*++=:....
      .=%%#@@#@@@@@%@@@%@@@@@@@@@@@@@#+..           .           :--....    :.:+-.:#%%@%%@@@#*+=:....
      .*+@@@@#@@@@@%@@@%@@@@@@@@@@@@@@@#+-.  .                       .:  .  .:+*---#%#@@@@@#++-:....
      -*@@@@@@@@@@@#%@@%%@@@@@@%@@@@@@@@@*-:.:.    .:....             ..    ..=+-::+%*@@@@@@*----...
     .::+@@@@@@@@@@@*@@@*%@@@@@@@@@@@@@@@@@@%=::.            :==::.          =:-++-=%-@@@@@%**--:.. 
     ..-=%@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@%#-=+=-.         ::...-.     .*--#*+*=@@@@@#+=-::...
      .-=#@@@@@@@@@@@@@@%@@@%@@@@@@@@%@@@@@@@@@@@@@@@@@*+*-::      ... --:. :.:+:#%#+#@@@@@%+-=::.. 
     ..-=#@@@@@@@@@@@@@@#%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=          . .:= =. *==@%%*+%@@@%+=--....
      .:-#@@@@@@@@@@@@@@@*#@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+. .       -== ...=+:@%@*:#@@@%#+=:..  
      .:@@@@@@@@@@@@@@@@@*+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+.       :=-   -++=*#%-:@@@@@%=-:.:..
       =@@%@@@@@@@@@@@@@@%*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+-    . .:=.  ++++-%==%@@@@#*=--:.. 
     ..:#*+#@@@@@@@@@@@@@@@##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-    -   =- .*+%*-=-%@@@@#++=-.... 
        .:*%@@@@@@@%@@@@@@@@#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*: .  -  -- =+=%:==%@@@@%*+=-:.....
        ..-*%@@@@@@##@@@@@@@@%@@@@@@@@@@@@@@@@@%##%@@@@@@@@@@@@@@@-    .:.:.-**@%-%%@@@@@%++=-:.....
        ...=*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%:     .=@@@@@@@@@@@@@#.  .:. ..#%@=:+@@@@@@@*++=-:--...
          .-=*@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@=        -%@@@@@@@@@@@#:  :-:  +#%#:=@@@@@@%*+=--...... 
          .:==*@@@@@@@@@@@@@@@@@@@@@@@@@@@@%-        :@@@@@@@@@@@@#-  =-: .=@*:%@@@@@@%*+---:::.....
         :.--=+*%@@@@@@@@@@@@@@@@@@@@@@@@@@@*.      :*@@@@@@@@@@@@+ ..:+. *@++@@@@@@@%#+=+--:.......
        ....:+@@#@@@@@@@@@@@@@@@@@@%@@@@@@@@@%+=---#@@@@@@@@@@@@@*.: :++.+#%@@#@@@@%#*=-:---........
          --:*+-*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%-: .#=.%%@%+@@@@@@##=:-::..... ....
             ..::+**@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#-. -+.-%@##@@@@@@@#*+-::............
               ...-*#%#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+:::  =%@@@@@@@@@*##+=--:....:. .....
                  ..:%++*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*-.::  +@@@@@@@@@%#*+=--..::. ..  ......
                   ..:-+*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+--:::+@@@@@@@@@@@#*=---::....:...........
                   .. .-=--*%@@@@@@@@@@@@@@@@@@@@@@@@@@*++=*%@@@@@@@@@@@@%++==-:::..................
                   .....::.:==*%##*#@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@%*#+++-:::..:... ..............
                       .:....:---===+**%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+===+=-:......................
                        :.   ...:---..:=+++#%#%@###+=**+**@@*%@@%#%#+=--:--::.......................
                             ... :....:...:=====---::==:--**+*++==+++-:-::..........  .........:....
                                 :         .::....:::::..:..:.::---==::::.... ..... ........:.....:.
                                    .  .. . .. .  .......:.......:::.....  . . .................::::
                                                         ......-.....       .  .............::::::::
                                                            ..  ....   ..    ...............::::::::
\033[0m
''')

# ANSI color codes for terminal text colors
COLOR_YOUR = "\033[94m"  # Blue
COLOR_OTHER = "\033[92m"  # Green
COLOR_RESET = "\033[0m"

HOST = '0.0.0.0'  # Listen on all interfaces
PORT = 9090

def receive_messages(conn, addr):
    while True:
        try:
            message = conn.recv(1024).decode('utf-8')
            if not message:
                print(f"\nConnection closed by client {addr}.")
                break
            if message.lower() == 'quit':
                print(f"\nClient {addr} requested to quit.")
                break
            # Print received message
            print(f"\n{COLOR_OTHER}Client says: {message}{COLOR_RESET}")
            print("> ", end='', flush=True)  # Reprint prompt after message
        except ConnectionResetError:
            print(f"\nConnection lost from client {addr}.")
            break
        except Exception as e:
            print(f"\nError receiving message: {e}")
            break
    conn.close()
    print("Connection closed. Server shutting down.")
    sys.exit(0)

def send_messages(conn):
    while True:
        try:
            message = input("> ")
            if message.lower() == 'quit':
                conn.sendall(message.encode('utf-8'))
                print("Quitting...")
                break
            conn.sendall(message.encode('utf-8'))
            print(f"{COLOR_YOUR}You: {message}{COLOR_RESET}")
        except BrokenPipeError:
            print("Connection lost. Unable to send message.")
            break
        except Exception as e:
            print(f"Error sending message: {e}")
            break
    conn.close()
    sys.exit(0)

def main():
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind((HOST, PORT))
    server.listen(1)
    print(f"Server listening on {HOST}:{PORT}. Waiting for a connection...")

    conn, addr = server.accept()
    print(f"Connected by {addr} - You can start chatting. Type 'quit' to exit.")

    # Start receiver thread
    recv_thread = threading.Thread(target=receive_messages, args=(conn, addr), daemon=True)
    recv_thread.start()

    # Main thread handles sending messages
    send_messages(conn)

if __name__ == "__main__":
    main()

